# React Reconciliation(재조정)

중요도: 상
태그: 완료

react를 사용하다보면 state나 props가 갱싱되면 render( ) 함수가 새로운 엘리먼트 트리를 반환한다. 이때 가장 효과적으로 UI를 갱신 하는 방법!

React는 두 가지 가정을 기반하여 O(n)의 휴리스틱 알고리즘을 구현했다.

- 서로 다른 타입의 두 엘리먼트는 서로 다른 트리를 만들어낸다.
- key를 통해 엘리먼트에 고윳값을 줘 어떤 자식 엘리먼트가 변경되지 않아야 할지 알려준다.

**비교 알고리즘 (Diffing Algorithm)**

두 엘리먼트의 타입이 다르면 React는 이전 트리를 버리고 새로운 트리를 구축한다.

아래와 같이 div 에서 span으로 바뀌는 경우 Counter도 사라지고 새로 다시 마운트 된다.

```jsx
<div>
	<Counter/>
</div>

<span>
	<Counter/>
</span>
```

**DOM 엘리먼트의 타입이 같은 경우**

엘리먼트 타입이 같은 경우는 내부 속성을 비교해서 동일한 내역은 유지하고 변경된 속성만 갱신한다.

```jsx
<div className="before" title="stuff" />

<div className="after" title="stuff" />
```

**자식에 대한 재귀적 처리**

아래와 같이 자식 끝에 엘리먼트 추가 시에는 성능상 크게 문제가 없는데 앞에 추가 될 경우 두가지 공통된 엘리먼트는 유지되는게 아닌 새로 생성된다. 따라서 성능이 좋지않음.

```jsx
<ul>
  <li>first</li>
  <li>second</li>
</ul>

<ul>
  <li>first</li>
  <li>second</li>
  <li>third</li>
</ul>
```

이러한 문제를 해결하기 위해, React는 `key`
속성을 지원합니다. 자식들이 key를 가지고 있다면, React는 key를 통해 기존 트리와 이후 트리의 자식들이 일치하는지 확인합니다.

해당 key는 오로지 형제 사이에서만 유일하면 되고, 전역에서 유일할 필요는 없습니다.

인덱스를 key로 사용할 경우 고윳값이 아니기 때문에 배열이 재배열되면 컴포넌트의 순서가 바뀌었을 때 key또한 바뀌어서 컴포넌트의 state가 엉망이 되거나 의도하지 않은 방식으로 바뀔 수도 있습니다.
